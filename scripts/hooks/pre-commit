#!/bin/bash
# Pre-commit to avoid pushing files larger than 5MB to the github repository

# Author: Louis Munier - lmunier@protonmail.com
# Date: 2024-10-09

# Maximum file size in bytes (5MB)
max_size=5242880

# Find files larger than the specified size
large_files=$(git diff --cached --name-only | xargs -I{} find {} -type f -size +${max_size}c 2>/dev/null)

if [ -n "$large_files" ]; then
  echo "The following files are too large to commit:"
  echo "$large_files"
  exit 1
fi

# Check if .gitmodules has changes related to submodule docker_ros_coppeliasim
if git diff --cached --name-only | grep -q '.gitmodules'; then
  if git diff --cached .gitmodules | grep -q 'tools/docker_ros_coppeliasim'; then
    # Stash changes to .gitmodules related to docker_ros_coppeliasim
    git stash push -m "Stash .gitmodules changes for submoduleA" .gitmodules
    echo "Stashed changes to .gitmodules related to submoduleA"
  fi
fi

exit 0
